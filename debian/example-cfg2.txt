# downloaded from http://hege.li/howto/spam/etc/postfwd/postfwd.conf
# check for more recent versions!

## Check DNS Whitelisting

id=OK_DNSWL; \
  rbl=list.dnswl.org/127/43200; \
  rbl=hostkarma.junkemailfilter.com/127.0.0.[13]; \
  action=OK

## Check HELO and reverse DNS

id=SET_HELO; \
  helo_name=^(\[|[^.]+$|.*?[0-9.-]{8}); \
  action=set(HIT_helo=1)

id=SET_NODNS; \
  client_name=^unknown$; \
  action=set(HIT_nodns=1)

id=REJECT_HELO_NODNS; \
  HIT_helo==1; HIT_nodns==1; \
  action=REJECT Your HELO is suspicious and no reverse DNS

## Check ZEN for immediate blocking

id=REJECT_RBL_ZEN; \
  rbl=zen.spamhaus.org; \
  action=REJECT You are listed in zen.spamhaus.org DNSBL

## Check DNSBLs

&&DNSBLS { \
  rbl=bl.spamcop.net; \
  rbl=dnsbl-1.uceprotect.net; \
  rbl=psbl.surriel.org; \
  rbl=dnsbl.ahbl.org; \
  rbl=dnsbl.njabl.org; \
  rbl=list.dsbl.org; \
  rbl=dnsbl.sorbs.net; \
  rbl=ix.dnsbl.manitu.net; \
  rbl=hostkarma.junkemailfilter.com/127.0.0.2; \
};

id=EVAL_DNSBLS; \
  &&DNSBLS; rblcount=all; \
  action=set(HIT_rbls=$$rblcount)

id=REJECT_RBL_MULTI; \
  HIT_rbls>=2; \
  action=REJECT You are listed in several DNSBLs

## Check RHSBLs

&&RHSBLS_REVERSE { \
  rhsbl_reverse_client=l1.apews.org; \
  rhsbl_reverse_client=rddn.dnsbl.net.au; \
  rhsbl_reverse_client=dynamic.rhs.mailpolice.com; \
};

&&RHSBLS_SENDER { \
  rhsbl_sender=multi.uribl.com; \
  rhsbl_sender=multi.surbl.org; \
  rhsbl_sender=rhsbl.ahbl.org; \
  rhsbl_sender=rhsbl.sorbs.net; \
  rhsbl_sender=dsn.rfc-ignorant.org; \
};

id=EVAL_RHSBLS; \
  &&RHSBLS_REVERSE; &&RHSBLS_SENDER; rhsblcount=all; \
  action=set(HIT_rhsbls=$$rhsblcount)

id=REJECT_RHSBL_MULTI; \
  HIT_rhsbls>=2; \
  action=REJECT You are listed in several RHSBLs

## Combined checks

id=REJECT_RBL_RHSBL; \
  HIT_rbls>=1; HIT_rhsbls>=1; \
  action=REJECT You are DNSBL and RHSBL listed

id=REJECT_RBL_HELO; \
  HIT_rbls>=1; HIT_helo==1; \
  action=REJECT You are DNSBL listed and HELO is suspicious

id=REJECT_RBL_NODNS; \
  HIT_rbls>=1; HIT_nodns==1; \
  action=REJECT You are DNSBL listed and no reverse DNS

id=REJECT_RHSBL_HELO; \
  HIT_rhsbls>=1; HIT_helo==1; \
  action=REJECT You are RHSBL listed and HELO is suspicious

id=REJECT_RHSBL_NODNS; \
  HIT_rhsbls>=1; HIT_nodns==1; \
  action=REJECT You are RHSBL listed and no reverse DNS

## Greylist suspicious

id=GREY_RBL; HIT_rbls>=1; action=check_postgrey
id=GREY_RHSBL; HIT_rhsbls>=1; action=check_postgrey

